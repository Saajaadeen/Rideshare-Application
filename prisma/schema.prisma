generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider = "postgresql"
}

model User {
  id                              String    @id @default(uuid())
  baseId                          String?
  firstName                       String
  lastName                        String
  phoneNumber                     String
  email                           String    @unique
  password                        String
  isAdmin                         Boolean   @default(false)
  isDriver                        Boolean   @default(false)
  isPassenger                     Boolean   @default(true)
  isReset                         Boolean   @default(false)
  resetCode                       String?
  createdAt                       DateTime  @default(now())
  updatedAt                       DateTime  @updatedAt
  isInvite                        Boolean   @default(false)
  inviteId                        String?   @unique
  inviteCode                      String?
  invites                         Invite[]  @relation("InviteRelation")
  driver                          Request[] @relation("DriverRelation")
  requests                        Request[] @relation("PassengerRelation")
  resets                          Reset[]   @relation("ResetLinks")
  base                            Base?     @relation(fields: [baseId], references: [id])
  invite                          Invite?   @relation("UserInviteRelation", fields: [inviteId], references: [id])
  vehicles                        Vehicle?
  emailVerified                   Boolean   @default(false)
  emailVerificationCode           String?
  emailVerificationCodeExpiration DateTime?
  emailVerificationAttempts       Int       @default(0)
  emailVerificationCodeSendLimit  DateTime?
}

model Invite {
  id        String   @id @default(uuid())
  email     String   @unique
  userId    String
  code      String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  isActive  Boolean  @default(true)
  user      User     @relation("InviteRelation", fields: [userId], references: [id])
  usedBy    User?    @relation("UserInviteRelation")
}

model Vehicle {
  id        String   @id @default(uuid())
  userId    String?  @unique
  year      String
  make      String
  model     String
  color     String
  plate     String   @unique
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User?    @relation(fields: [userId], references: [id])
}

model Station {
  id              String    @id @default(uuid())
  baseId          String
  name            String    @unique
  longitude       String
  latitude        String
  description     String?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  dropoffRequests Request[] @relation("DropoffStation")
  pickupRequests  Request[] @relation("PickupStation")
  base            Base      @relation(fields: [baseId], references: [id])
}

model Request {
  id           String    @id @default(uuid())
  baseId       String?
  userId       String?
  driverId     String?
  pickupId     String?
  dropoffId    String?
  status       String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  acceptedAt   DateTime?
  pickedUpAt   DateTime?
  droppedOffAt DateTime?
  base         Base?     @relation("BaseRelation", fields: [baseId], references: [id])
  driver       User?     @relation("DriverRelation", fields: [driverId], references: [id])
  dropoff      Station?  @relation("DropoffStation", fields: [dropoffId], references: [id])
  pickup       Station?  @relation("PickupStation", fields: [pickupId], references: [id])
  user         User?     @relation("PassengerRelation", fields: [userId], references: [id])
}

model Base {
  id           String    @id @default(uuid())
  name         String
  abbreviation String?
  state        String
  long         String
  lat          String
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  requests     Request[] @relation("BaseRelation")
  stations     Station[]
  users        User[]
}

model Reset {
  id           String     @id @default(uuid())
  token        String
  userId       String
  validUntil   DateTime
  code         String
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  user         User?      @relation("ResetLinks", fields: [userId], references: [id])
}

model UsedTurnstileToken {
  id        String   @id @default(cuid())
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())

  @@index([expiresAt])
  @@map("used_turnstile_tokens")
}